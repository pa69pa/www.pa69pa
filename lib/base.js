var currGallery;var currGalleryArr=[];var isPlay=true;var isCycle=true;var isFrag=false;var isAnim=false;var isPano=true;var secView=1;var jump=1;var jumpW=1;var viewTimer;var menuTimer;var tG=[2000,7600,9000,8000,90,40];function nul(){return false}function gT(f,e,a,c,d){if(c>d){return 1}var b=1;if(e!=null){b=e[a]||1}return((isPlay)?tG[f]:tG[f]/tG[5])*b*jumpW}function getOther(a){return(a=="sel")?"all":"sel"}function getView(a){return(a==-1)?secView:((secView==1)?2:1)}function ruleBut(b,a){if(a==true){$("#"+b).removeClass("butno")}else{$("#"+b).addClass("butno").css({opacity:0.4})}}function rulePlay(a){if(a){$("#play").attr({src:"img/play.png",title:"Поехали!"})}else{$("#play").attr({src:"img/stop.png",title:"Стоп анимации"})}}function menuHover(e,c,b){if(b==0){$(e).stop(true,true).fadeTo("slow",0.9);$("#"+c+"menu").stop(true,true).fadeOut("slow")}else{$(e).stop(true,true).fadeTo("slow",1);var a=$("#"+c+"menu");a.stop(true,true);if(c=="all"){a.width($(document).width()-160)}else{var d=a.width();if(d<200){a.width(d*2+50)}}a.fadeTo("slow",1)}}function menuClick(c,b){menuHover(c,b,0);$("#tit").removeClass("butno");setGallery($(c).attr("id"),b);var a;if(b=="all"){a=$("em",c).text()}else{a=$(c).text()}$("#"+b+" .menubut").text(a)}function setGallery(b,a){if(currGallery!=b){stopS();hidePano();$(".view").each(function(c){$(this).data("imgCurr",-1).data("imgLoad",-2).data("imgGet",-3)});isPlay=true;isAnim=false;ruleBut("play",false);rulePlay(false);currGallery=b;$("#"+a+" .menubut").addClass("menucur");$("#"+getOther(a)+" .menubut").removeClass("menucur");$.getJSON("galleries/"+b+".json",function(c){currGalleryArr=c.imgs;loadImg(0)})}}function goTo(d){if(!$("#"+((d>0)?("next"):("prev"))).hasClass("butno")){hidePano();clearTimeout(viewTimer);isPlay=false;isAnim=false;ruleBut("next",false);ruleBut("prev",false);ruleBut("play",false);rulePlay(false);var b=$("#img"+getView(1));if(d<0){loadImg(b.data("imgCurr")-1)}else{var a=$("#img"+getView(-1));if((b.data("imgCurr")+1)==a.data("imgLoad")){viewImg()}else{loadImg(b.data("imgCurr")+1)}}}}function goPS(){var b=$("#play");if(!$(b).hasClass("butno")){var d=$(b).attr("src");d=d.substr(d.length-8,4);var e=$("#img"+getView(1));if(d=="play"){hidePano();isPlay=true;rulePlay(false);ruleBut("play",true);if(isAnim){animImg($("#img"+getView(1)+" img"))}var a=$("#img"+getView(-1));if((e.data("imgCurr")+1)==a.data("imgLoad")){setImg()}else{loadImg(e.data("imgCurr")+1)}}else{unBut();isPlay=false;rulePlay(true);ruleBut("play",true);stopS();if(isAnim){showPano()}}}}function stopS(){if(isAnim){var a=$("#img"+getView(1)+" img");$(a).queue("fx",[]);$(a).stop()}clearTimeout(viewTimer)}function unBut(){var a=$("#img"+getView(1)).data("imgCurr");if(a==0){ruleBut("next",true);ruleBut("prev",false)}else{if(a==currGalleryArr.length-1){ruleBut("prev",true);ruleBut("next",false)}else{ruleBut("next",true);ruleBut("prev",true)}}}function loadImg(a){if(a>currGalleryArr.length-1){if(isCycle){a=0}else{return}}$("#img"+getView(-1)).data("imgGet",a);$("#img"+getView(-1)+" img").attr("src","img/0.gif");$("#ler").attr("src","img/load.gif");ruleBut("next",false);ruleBut("prev",false);if(!isAnim){ruleBut("play",false)}$.getJSON("galleries/img/"+currGalleryArr[a]+".json",function(e){var c=$("#img"+getView(-1));c.data(e);var b=e.img.i[0];var d=$("body").data(b.substr(0,1));if(b.length>1){b=b.substr(1)+"/"}else{b="/"}d=d[0]+b+d[1]+currGalleryArr[a];$("img",c).attr({width:"50",height:"50",src:d})})}function loadSrc(a){var b=$(a).attr("src");b=b.substr(b.length-5).toUpperCase();if(b!="0.GIF"){$("#ler").attr("src","img/0.gif");var c=$("#img"+getView(-1));c.data("imgLoad",c.data("imgGet"));setImg()}}function setImg(){if(isAnim){viewTimer=setTimeout("setImg()",4000)}else{var a=$("#infa");if(a.is(":visible")){a.fadeOut("slow")}if(!$("#tit").hasClass("butno")){a=$("#tool");if(a.is(":visible")){a.fadeOut("slow")}if(menuTimer!=null){clearTimeout(menuTimer)}}viewImg()}}function viFull(c,e,b,d){var f=c/b;var a=e/d;if(f<a){return{width:c,height:Math.ceil(d*f),top:Math.ceil((e-d*f)/2),left:0}}else{return{width:Math.ceil(b*a),height:e,top:0,left:Math.ceil((c-b*a)/2)}}}function viFrag(b,d,a,c,e){if(e[0]<0){return viFragFill(b,d,a,c,e)}else{return viFragFrame(b,d,a,c,e)}}function viFragFill(a,f,d,j,i){var b=Math.max(a/d,f/j);var g=Math.ceil(d*b);var e=Math.ceil(j*b);var c=a-g;if(c<0){c=Math.ceil(c*i[1]/(i[1]+i[3]))}else{c=c/2}var h=f-e;if(h<0){h=Math.ceil(h*i[0]/(i[0]+i[2]))}else{h=h/2}return{width:g,height:e,top:h,left:c}}function viFragFrame(a,g,d,k,j){var e=j[2]-j[0];var n=j[3]-j[1];var b=Math.min(a/e,g/n);if(b>1.5){b=1.5}var h=Math.ceil(d*b);var f=Math.ceil(k*b);var c=Math.ceil(a/2-(j[0]+e/2)*b);if(c>0){c=0}if((h+c)<a){c=a-h}if(c>0){c=c/2}var i=Math.ceil(g/2-(j[1]+n/2)*b);if(i>0){i=0}if((f+i)<g){i=g-f}if(i>0){i=i/2}return{width:h,height:f,top:i,left:c}}function viewImg(){var g=null;var e=$("#img"+getView(-1));$("img",e).attr({width:null,height:null}).css({width:"",height:"",top:"0px",left:"0px"});var b=e.width();var d=e.height();var a=e.data("img")["i"][1];var c=e.data("img")["i"][2];if(isFrag){f==null}else{var f=e.data("img")["<"]||null;if(f!=null){g="<"}else{f=e.data("img")["^"]||null;if(f!=null){g="^"}}}if(f==null){$("img",e).css(viFull(b,d,a,c))}else{$("img",e).css(viFrag(b,d,a,c,f))}$("#img"+getView(1)).fadeOut(tG[0],function(){$(this).css("z-index","22");var h=$("#img"+getView(-1));h.css("z-index","33");(secView==1)?(secView=2):(secView=1);$(this).show(0);h.data("imgCurr",h.data("imgLoad"));if(isPlay){loadImg(h.data("imgCurr")+1)}if(f==null){f=h.data("img")[">"]||null;if(f!=null){g=">"}}h=$("#img"+getView(1)+" img");if(isFrag){h.data("ft","default")}else{h.data("ft",g).data("frag",f).data("dw",b).data("dh",d).data("iw",a).data("ih",c).data("ti",0)}ruleBut("play",true);rulePlay(false);isAnim=true;animImg(h)})}function animImg(f){var g=f.data("frag");var b=f.data("dw");var e=f.data("dh");var a=f.data("iw");var d=f.data("ih");var c=f.data("ti");switch(f.data("ft")){case"<":$(f).delay(gT(1,g,4,c,0)).queue(function(){$(this).data("ti",1);$(this).dequeue()}).animate(viFull(b,e,a,d),gT(3,g,5,c,1),function(){$(this).data("ti",3);$(this).delay(gT(2,g,6,c,2)).queue(function(){animOk(this)})});break;case">":$(f).delay(gT(2,g,4,c,0)).queue(function(){$(this).data("ti",1);$(this).dequeue()}).animate(viFrag(b,e,a,d,g),gT(3,g,5,c,1),function(){$(this).data("ti",2);$(this).delay(gT(1,g,6,c,2)).queue(function(){$(this).data("ti",3);animFrag(b,e,a,d,c,3,this,1);$(this).dequeue()})});break;case"^":$(f).delay(gT(1,g,4,c,0)).queue(function(){$(this).data("ti",1);animFrag(b,e,a,d,c,1,this,1);$(this).dequeue()});break;default:$(f).data("ti",1);$(f).delay((c==1)?1:((isPlay)?tG[2]:tG[4])).queue(function(){animOk(this)});break}}function animFrag(a,g,d,i,b,f,e,c){var h=$("#img"+getView(1)).data("img")[("-"+c)]||null;if(h==null){animFull(a,g,d,i,b,f,e)}else{$(e).queue(function(){$(this).animate(viFrag(a,g,d,i,h),gT(3,h,4,b,f),function(){$(this).data("ti",(f+1));$(this).delay(gT(1,h,5,b,(f+1))).queue(function(){$(this).data("ti",(f+2));animFrag(a,g,d,i,b,(f+2),this,c+1);$(this).dequeue()})});$(this).dequeue()})}}function animFull(b,f,a,e,c,d,g){var h=$("#img"+getView(1)).data("img")["-<"]||null;if(h==null){animOk(g)}else{$(g).queue(function(){$(this).animate(viFrag(b,f,a,e,h),gT(3,h,4,c,d),function(){$(this).data("ti",(d+1));$(this).delay(gT(1,h,5,c,(d+1))).queue(function(){$(this).data("ti",(d+2));$(this).dequeue()}).animate(viFull(b,f,a,e),gT(3,h,6,c,(d+2)),function(){$(this).data("ti",(d+3));$(this).delay(gT(2,h,7,c,(d+2))).queue(function(){animOk(this)})})});$(this).dequeue()})}}function animOk(a){$(a).queue("fx",[]);$(a).stop();if($("#img"+getView(1)).data("imgCurr")==currGalleryArr.length-1&&!isCycle){isPlay=false}if(!isPlay){unBut();rulePlay(true);ruleBut("play",true);showPano()}isAnim=false;jumpW=jump}function showPano(){if(isPano){var f=$("#img"+getView(1)+" img").attr("src");var g=$("#ipan");if(f==g.attr("src")){$("#vip").fadeIn("slow");$("#pano").fadeIn("slow")}else{var d=$("#img"+getView(1));var a=$(d).width();var j=$(d).height();var c=$(d).data("img")["i"][1];var m=$(d).data("img")["i"][2];var e=c/a;var b=m/j;if(e>1.33||b>1.33){b=m/c;if(b<0.8){c=150*c/m;m=150}else{if(b<1.2){m=145*m/c;c=145}else{m=150*m/c;c=150}}if(m>j-20){c=(j-20)*c/m;m=j-20}if(c>a-20){m=(a-20)*m/c;c=a-20}e={width:c,height:m};b={top:(j-m-10),left:(a-c-10)};var l=$("#zoom");var k=$("#pano");var h=l.data("zoom");if(h!=null){h.destroy()}g.attr("src",f);l.attr("href",f);g.css(e);k.css(e).css(b);l.CloudZoom();$("#vip").fadeIn("slow");k.fadeIn("slow")}}}}function hidePano(){$("#vip:visible").fadeOut("slow");$("#pano:visible").fadeOut("slow")}function clickPano(a){if(isPano){isPano=false;hidePano();$(a).attr({src:"img/nopa.png",title:"Включить панорамный просмотр фоток"})}else{isPano=true;if(!isPlay){showPano()}$(a).attr({src:"img/pano.png",title:"Убрать панорамный просмотр фоток"})}}function onRes(){var b=$(window).height();$("#pani").css("margin-top",(b-520));$("#infa").css("top",(b-76));var a=$("#cast");a.css("top",(b-a.height()-20));$("#about").css({left:$(window).width()-365,top:(76-b),height:b})}function for00(a){return(Math.round(a*100)/100).toFixed(2)}function sliderCh(){var a=$("#slider").slider("option","value");if(a==50){jump=1;a=" нейтрал"}else{if(a<50){jump=for00(-0.125+0.0225*a);a=" быстрее в "+for00(11-10*jump)+" раз"}else{jump=for00(-8+0.18*a);a=" медленнее в "+jump+" раз"}}$("#sC").text(a)}function hideMenu(){$("#tool").fadeOut("slow")}function ya(a){$("#ya").fadeIn("slow")}$(document).ready(function(){$(".menubut").css({opacity:0.4}).mouseover(function(){if(!$(this).hasClass("butno")){$(this).css({opacity:1})}}).mouseout(function(){if(!$(this).hasClass("butno")){$(this).css({opacity:0.4})}});$.getJSON("galleries/index.json",function(c){var b=$("#sel").position().top-70;$("<ul id='selmenu' class='menu sb ab'></ul>").css({top:b+"px"}).appendTo("#sel");var a=0;$.each(c.bests,function(d){a++;$('<li id="'+d+'">'+c.bests[d]+"</li>").css({opacity:0.4}).mouseover(function(){$(this).css({opacity:1})}).mouseout(function(){$(this).css({opacity:0.4})}).click(function(){menuClick(this,"sel")}).appendTo("#selmenu")});$("#sel").hover(function(){menuHover(this,"sel",1)},function(){menuHover(this,"sel",0)});a=$("#selmenu li:nth-child("+(Math.floor(Math.random()*(a))+1)+")");setGallery(a.attr("id"),"sel");$("#sel .menubut").text(a.text());b=$("#all").position().top-80;$("<ul id='allmenu' class='menu sb ab'></ul>").css({top:b+"px"}).appendTo("#all");$.each(c.beall,function(d){$('<li id="'+d+'"><em>'+c.beall[d][0]+"</em> &nbsp; "+c.beall[d][1]+"<br/><span>"+c.beall[d][2]+"</span></li>").css({opacity:0.4,"line-height":"70%"}).mouseover(function(){$(this).css({opacity:1})}).mouseout(function(){$(this).css({opacity:0.4})}).click(function(){menuClick(this,"all")}).appendTo("#allmenu")});$("#all").hover(function(){menuHover(this,"all",1)},function(){menuHover(this,"all",0)});$("body").data(c.addr)});$(".view img").load(function(){loadSrc(this)});$(window).resize(function(){onRes()});onRes();$("#infa").fadeTo("slow",1);$("#info").click(function(){$("#cast:visible").fadeOut(0);$("#infa").fadeToggle("slow")});$("#cost").click(function(){$("#infa:visible").fadeOut(0);$("#cast").fadeToggle("slow")});$("#pani").click(function(){clickPano(this)});$("#ya").mouseleave(function(){$(this).fadeOut("slow")});$('input[type="submit"]').css({padding:"0px 3px"}).addClass("pblock");$("#slider").slider({max:100,min:10,value:50,slide:sliderCh});$("#tit").hover(function(){$("#tool:hidden").fadeIn("slow");$("#tit").addClass("butno");if(menuTimer!=null){clearTimeout(menuTimer)}},function(){$("#tit").removeClass("butno");menuTimer=setTimeout("hideMenu()",5000)});$("#tool").hover(function(){$(this).css("background-color","#1e1e1e")},function(){$(this).css("background-color","transparent")});$("#tech").hover(function(){$("#about").stop(true,true).fadeIn("slow")},function(){$("#about").stop(true,true).fadeOut(200)});$("#tech A").each(function(){$(this).mouseover(function(){$("#about").attr("src","pa.html#"+$(this).attr("id"))})});$("#ci").change(function(){isCycle=$(this).attr("checked")});$("#an").change(function(){isFrag=$(this).attr("checked")});$(document).keydown(function(b){var a=b.keyCode;if(a=="13"||a=="32"){b.preventDefault();goPS()}if(a=="39"||a=="34"){goTo(1)}if(a=="37"||a=="33"){goTo(-1)}if(a=="73"||a=="66"){$("#cast:visible").fadeOut(0);$("#infa").fadeToggle("slow")}if(a=="65"||a=="70"){}if(a=="80"||a=="71"){clickPano($("#pani"))}if(a=="67"||a=="89"){$("#infa:visible").fadeOut(0);$("#cast").fadeToggle("slow")}if(a=="77"||a=="86"||a=="84"||a=="78"){$("#tool").fadeToggle("slow");if(menuTimer!=null){clearTimeout(menuTimer)}}})});